<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador ICFES Pro</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(99, 102, 241, 0.2) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(168, 85, 247, 0.2) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      position: relative;
      z-index: 1;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .header .subtitle {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .theme-selector {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      margin-top: 20px;
      border-radius: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .theme-btn {
      padding: 8px 16px;
      border: 2px solid white;
      background: transparent;
      color: white;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9em;
      font-weight: 500;
    }

    .theme-btn:hover {
      background: white;
      color: #667eea;
      transform: translateY(-2px);
    }

    .theme-btn.active {
      background: white;
      color: #667eea;
    }

    .content {
      padding: 30px;
    }

    .config-panel {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #495057;
      font-size: 0.95em;
    }

    .input-group input,
    .input-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 25px;
    }

    .btn {
      flex: 1;
      padding: 15px 25px;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(245, 87, 108, 0.4);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 1.2em;
      color: #667eea;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .progreso {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 25px;
      text-align: center;
    }

    .progreso strong {
      display: block;
      margin-bottom: 12px;
      color: #495057;
      font-size: 1.1em;
    }

    .progreso-bar {
      width: 100%;
      height: 12px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin: 15px 0;
    }

    .progreso-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.5s ease;
    }

    .progreso small {
      color: #6c757d;
      font-size: 0.9em;
    }

    .pregunta-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 20px;
    }

    .pregunta-numero {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      font-size: 0.9em;
    }

    .pregunta-texto {
      font-size: 1.15em;
      line-height: 1.7;
      color: #2c3e50;
      margin-bottom: 25px;
      font-weight: 500;
    }

    .opciones {
      display: grid;
      gap: 12px;
    }

    .opcion-btn {
      width: 100%;
      padding: 18px 20px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 12px;
      text-align: left;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1em;
      color: #495057;
      font-weight: 500;
    }

    .opcion-btn:hover:not(:disabled) {
      border-color: #667eea;
      background: #f8f9ff;
      transform: translateX(5px);
    }

    .opcion-btn.correcta {
      background: #d4edda;
      border-color: #28a745;
      color: #155724;
    }

    .opcion-btn.incorrecta {
      background: #f8d7da;
      border-color: #dc3545;
      color: #721c24;
    }

    .opcion-btn:disabled {
      cursor: not-allowed;
    }

    .feedback {
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
      font-size: 1.05em;
      font-weight: 500;
    }

    .feedback.correcto {
      background: #d4edda;
      border-left: 5px solid #28a745;
      color: #155724;
    }

    .feedback.incorrecto {
      background: #f8d7da;
      border-left: 5px solid #dc3545;
      color: #721c24;
    }

    .explicacion {
      background: #e7f3ff;
      padding: 20px;
      border-radius: 12px;
      margin-top: 15px;
      border-left: 5px solid #2196F3;
    }

    .explicacion strong {
      color: #1976D2;
      display: block;
      margin-bottom: 10px;
      font-size: 1.05em;
    }

    .resultado-final {
      text-align: center;
      padding: 40px 20px;
    }

    .resultado-final h2 {
      font-size: 2em;
      color: #2c3e50;
      margin-bottom: 30px;
    }

    .estadisticas {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .stat-item {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 25px;
      border-radius: 15px;
      color: white;
    }

    .stat-numero {
      font-size: 3em;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 1em;
      opacity: 0.9;
    }

    .tema-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .tema-pill {
      padding: 6px 14px;
      background: #e7f3ff;
      border: 2px solid transparent;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.85em;
      transition: all 0.3s;
      color: #495057;
    }

    .tema-pill:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }

    .tema-pill.selected {
      background: #667eea;
      color: white;
      border-color: #5568d3;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8em;
      }

      .button-group {
        flex-direction: column;
      }

      .estadisticas {
        grid-template-columns: 1fr;
      }

      .theme-selector {
        flex-direction: column;
      }
    }

    .emoji-large {
      font-size: 5em;
      margin-bottom: 20px;
      animation: bounce 1s ease-in-out;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo-container" onclick="window.location.href='/dashboard'">
      <div class="logo-icon">üéì</div>
      <div class="logo-text">ICFES Pro</div>
    </div>
  </nav>

  <div class="container">
    <div class="header">
      <h1>üéì Simulador ICFES Pro</h1>
      <p class="subtitle">Practica con preguntas generadas por IA</p>
      
      <div class="theme-selector">
        <button class="theme-btn active" data-tema="matematicas">üìê Matem√°ticas</button>
        <button class="theme-btn" data-tema="lectura">üìñ Lectura Cr√≠tica</button>
        <button class="theme-btn" data-tema="ciencias">üß™ Ciencias</button>
        <button class="theme-btn" data-tema="sociales">üåç Sociales</button>
        <button class="theme-btn" data-tema="ingles">üåé Ingl√©s</button>
      </div>
    </div>

    <div class="content">
      <div class="config-panel">
        <div class="input-group">
          <label for="tema">üìö Tema espec√≠fico de las preguntas:</label>
          <input type="text" id="tema" placeholder="Ej: √°lgebra, gen√©tica, guerra fr√≠a..." value="razonamiento l√≥gico">
          <div class="tema-pills">
            <span class="tema-pill" data-valor="√°lgebra">√Ålgebra</span>
            <span class="tema-pill" data-valor="geometr√≠a">Geometr√≠a</span>
            <span class="tema-pill" data-valor="c√°lculo">C√°lculo</span>
            <span class="tema-pill" data-valor="estad√≠stica">Estad√≠stica</span>
          </div>
        </div>

        <div class="input-group">
          <label for="cantidad">üî¢ N√∫mero de preguntas:</label>
          <select id="cantidad">
            <option value="1">1 pregunta (R√°pido)</option>
            <option value="3">3 preguntas</option>
            <option value="5" selected>5 preguntas</option>
            <option value="7">7 preguntas</option>
            <option value="10">10 preguntas (Completo)</option>
          </select>
        </div>

        <div class="input-group">
          <label for="dificultad">‚ö° Nivel de dificultad:</label>
          <select id="dificultad">
            <option value="facil">üü¢ F√°cil - Conceptos b√°sicos</option>
            <option value="medio" selected>üü° Medio - Aplicaci√≥n</option>
            <option value="dificil">üî¥ Dif√≠cil - An√°lisis avanzado</option>
          </select>
        </div>

        <div class="button-group">
          <button id="btnGenerar" class="btn btn-primary">
            <span>üöÄ</span>
            <span>Generar Simulacro</span>
          </button>
          <button id="btnReset" class="btn btn-secondary">
            <span>üîÑ</span>
            <span>Reiniciar</span>
          </button>
        </div>
      </div>

      <div id="progreso" style="display: none;"></div>
      <div id="resultado"></div>
    </div>
  </div>

  <script>
    let preguntas = [];
    let preguntaActual = 0;
    let respuestas = [];
    let correctas = 0;

    const btnGenerar = document.getElementById('btnGenerar');
    const btnReset = document.getElementById('btnReset');
    const resultado = document.getElementById('resultado');
    const progreso = document.getElementById('progreso');
    const temaInput = document.getElementById('tema');

    // Theme buttons
    document.querySelectorAll('.theme-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        
        const tema = e.target.getAttribute('data-tema');
        const temas = {
          'matematicas': ['√°lgebra', 'geometr√≠a', 'c√°lculo', 'estad√≠stica'],
          'lectura': ['comprensi√≥n lectora', 'an√°lisis textual', 'argumentaci√≥n'],
          'ciencias': ['biolog√≠a', 'qu√≠mica', 'f√≠sica', 'gen√©tica'],
          'sociales': ['historia', 'geograf√≠a', 'econom√≠a', 'pol√≠tica'],
          'ingles': ['gram√°tica', 'vocabulario', 'comprensi√≥n de lectura']
        };
        
        const pills = temas[tema] || [];
        const pillsHTML = pills.map(t => `<span class="tema-pill" data-valor="${t}">${t}</span>`).join('');
        document.querySelector('.tema-pills').innerHTML = pillsHTML;
        
        // Reattach pill listeners
        attachPillListeners();
        
        if (tema === 'matematicas') temaInput.value = '√°lgebra';
        else if (tema === 'lectura') temaInput.value = 'comprensi√≥n lectora';
        else if (tema === 'ciencias') temaInput.value = 'biolog√≠a';
        else if (tema === 'sociales') temaInput.value = 'historia';
        else if (tema === 'ingles') temaInput.value = 'gram√°tica';
      });
    });

    // Tema pills
    function attachPillListeners() {
      document.querySelectorAll('.tema-pill').forEach(pill => {
        pill.addEventListener('click', (e) => {
          document.querySelectorAll('.tema-pill').forEach(p => p.classList.remove('selected'));
          e.target.classList.add('selected');
          temaInput.value = e.target.getAttribute('data-valor');
        });
      });
    }
    attachPillListeners();

    btnGenerar.addEventListener('click', generarSimulacro);
    btnReset.addEventListener('click', reiniciar);

    async function generarSimulacro() {
      const tema = temaInput.value.trim() || 'razonamiento l√≥gico';
      const cantidad = parseInt(document.getElementById('cantidad').value);
      const dificultad = document.getElementById('dificultad').value;

      btnGenerar.disabled = true;
      resultado.innerHTML = '<div class="loading">‚è≥ Generando preguntas con IA avanzada...</div>';
      progreso.style.display = 'none';

      try {
        const res = await fetch('http://localhost:5000/api/preguntas-multiples', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tema, cantidad, dificultad })
        });

        const data = await res.json();

        if (data.error) {
          resultado.innerHTML = `<div class="feedback incorrecto">‚ö†Ô∏è Error: ${data.error}</div>`;
          btnGenerar.disabled = false;
          return;
        }

        preguntas = data.preguntas;
        preguntaActual = 0;
        respuestas = [];
        correctas = 0;

        mostrarPregunta();
        btnGenerar.disabled = false;

      } catch (error) {
        resultado.innerHTML = `<div class="feedback incorrecto">‚ùå Error de conexi√≥n: ${error.message}<br><small>Verifica que el servidor est√© corriendo en http://localhost:5000</small></div>`;
        btnGenerar.disabled = false;
      }
    }

    function mostrarPregunta() {
      if (preguntaActual >= preguntas.length) {
        mostrarResultados();
        return;
      }

      const pregunta = preguntas[preguntaActual];
      progreso.style.display = 'block';
      
      const porcentajeProgreso = ((preguntaActual + 1) / preguntas.length) * 100;
      
      progreso.innerHTML = `
        <div class="progreso">
          <strong>Pregunta ${preguntaActual + 1} de ${preguntas.length}</strong>
          <div class="progreso-bar">
            <div class="progreso-fill" style="width: ${porcentajeProgreso}%"></div>
          </div>
          <small>‚úÖ ${correctas} correctas | ‚ùå ${preguntaActual - correctas} incorrectas</small>
        </div>
      `;

      let html = `
        <div class="pregunta-card">
          <div class="pregunta-numero">Pregunta ${pregunta.numero}</div>
          <div class="pregunta-texto">${pregunta.pregunta}</div>
          <div class="opciones">
      `;

      pregunta.opciones.forEach((opcion, index) => {
        const letra = String.fromCharCode(65 + index);
        html += `<button class="opcion-btn" data-letra="${letra}">${opcion}</button>`;
      });

      html += `</div></div>`;
      resultado.innerHTML = html;

      document.querySelectorAll('.opcion-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const seleccionada = e.target.getAttribute('data-letra');
          verificarRespuesta(seleccionada);
        });
      });
    }

    function verificarRespuesta(seleccionada) {
      const pregunta = preguntas[preguntaActual];
      const correcta = pregunta.respuesta_correcta;
      const esCorrecta = seleccionada === correcta;

      if (esCorrecta) correctas++;

      respuestas.push({
        pregunta: pregunta.pregunta,
        seleccionada: seleccionada,
        correcta: correcta,
        esCorrecta: esCorrecta
      });

      let html = `
        <div class="pregunta-card">
          <div class="pregunta-numero">Pregunta ${pregunta.numero}</div>
          <div class="pregunta-texto">${pregunta.pregunta}</div>
          <div class="opciones">
      `;

      pregunta.opciones.forEach((opcion, index) => {
        const letra = String.fromCharCode(65 + index);
        let clase = '';
        if (letra === correcta) clase = 'correcta';
        else if (letra === seleccionada) clase = 'incorrecta';
        html += `<button class="opcion-btn ${clase}" disabled>${opcion}</button>`;
      });

      html += '</div>';

      if (esCorrecta) {
        html += `<div class="feedback correcto">‚úÖ ¬°Excelente! Has seleccionado la respuesta correcta (${correcta}).</div>`;
      } else {
        html += `
          <div class="feedback incorrecto">
            ‚ùå Respuesta incorrecta. Seleccionaste <strong>${seleccionada}</strong>, pero la respuesta correcta es <strong>${correcta}</strong>.
          </div>
        `;
      }

      html += `
        <div class="explicacion">
          <strong>üí° Explicaci√≥n detallada:</strong>
          <p>${pregunta.explicacion}</p>
        </div>
      `;

      html += `<button onclick="siguientePregunta()" class="btn btn-primary" style="margin-top: 20px; width: 100%;">
        <span>‚û°Ô∏è</span>
        <span>${preguntaActual + 1 < preguntas.length ? 'Siguiente Pregunta' : 'Ver Resultados'}</span>
      </button>`;
      html += '</div>';

      resultado.innerHTML = html;
    }

    function siguientePregunta() {
      preguntaActual++;
      mostrarPregunta();
    }

    function mostrarResultados() {
      const porcentaje = Math.round((correctas / preguntas.length) * 100);
      let mensaje = '';
      let emoji = '';
      let color = '';

      if (porcentaje >= 90) {
        mensaje = '¬°Excelente! Dominas el tema perfectamente';
        emoji = 'üèÜ';
        color = '#28a745';
      } else if (porcentaje >= 70) {
        mensaje = '¬°Muy bien! Buen desempe√±o general';
        emoji = 'üéâ';
        color = '#17a2b8';
      } else if (porcentaje >= 50) {
        mensaje = 'Bien, pero hay espacio para mejorar';
        emoji = 'üìö';
        color = '#ffc107';
      } else {
        mensaje = 'Necesitas reforzar este tema';
        emoji = 'üí™';
        color = '#dc3545';
      }

      resultado.innerHTML = `
        <div class="resultado-final">
          <div class="emoji-large">${emoji}</div>
          <h2 style="color: ${color}">${mensaje}</h2>
          <div class="estadisticas">
            <div class="stat-item" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
              <div class="stat-numero">${correctas}</div>
              <div class="stat-label">Correctas</div>
            </div>
            <div class="stat-item" style="background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);">
              <div class="stat-numero">${preguntas.length - correctas}</div>
              <div class="stat-label">Incorrectas</div>
            </div>
            <div class="stat-item" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
              <div class="stat-numero">${porcentaje}%</div>
              <div class="stat-label">Acierto</div>
            </div>
          </div>
          <button onclick="reiniciar()" class="btn btn-primary" style="margin-top: 30px; width: 100%; max-width: 400px;">
            <span>üîÑ</span>
            <span>Hacer Otro Simulacro</span>
          </button>
        </div>
      `;

      progreso.style.display = 'none';
    }

    function reiniciar() {
      preguntas = [];
      preguntaActual = 0;
      respuestas = [];
      correctas = 0;
      resultado.innerHTML = '';
      progreso.style.display = 'none';
      temaInput.value = 'razonamiento l√≥gico';
      document.getElementById('cantidad').value = '5';
      document.getElementById('dificultad').value = 'medio';
      document.querySelectorAll('.tema-pill').forEach(p => p.classList.remove('selected'));
    }
  </script>
</body>
</html>